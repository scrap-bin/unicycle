## Установка ##

### Папки и права ###

| Папка       | Значение           |
|-------------|--------------------|
| app         | Ресурсы приложения |
| app/cache   | Временные файлы    |
| app/config  | Конфигурация       |
| bin         | Консольные утилиты |
| src         | Исходный код       |
| web         | Корень сайта       |

Следует настроить веб сервер так, чтобы папка `web` была DocumentRoot, а прочие папки были недоступны по http.
Файл `web/index.php` это фронт-контроллер, т.е. он должен принимать все запросы на несуществующие файлы.

Как правило сервер работает под пользовательским аккаунтом `www-data`. Этой учетке надо дать права на запись в папку 
`app/cache`.
Если вы будете выполнять какие-то команды их консоли, желательно делать это из-под той же учетки, чтобы создаваемые 
временные файлы были доступны веб-серверу.


### Требования ###

Фреймворк создается для версии PHP 5.4+. Проверить все требования и доступы можно из командной строки:
```bash
$ php bin/check.php
```


### Рабочая конфигурация ###

Все конфигурационные файлы находятся в папке `app/config`. Индивидуальные настройки держите в папке 
`app/config/parameters`. Файлы из нее игнорируются **git**, поэтому вы можете смело держать там свои секреты.

Образец для настроек вы найдете в файле `example.yml.dist`, если ваша конфигурация 
будет называться 'cofee', скопируйте файл-образец в `cofee.yml` и измените всё, что потребуется.

Фреймворк узнает с какой конфигурацией работать из переменной среды **APPLICATION_ENV**. Рекомендуем задавать
этот параметр в настройках веб-сервера. Например для Apache 2 это будет выглядеть так:
```apache
<VirtualHost *:80>
  DocumentRoot "/var/www/example/web/"
  ServerName "example.com"
#   set working configuration name
  SetEnv APPLICATION_ENV "cofee"
#   set front-controller
  DirectoryIndex index.php
  <IfModule mod_rewrite.c>
    RewriteEngine On
    RewriteCond %{REQUEST_FILENAME} !-f
    RewriteRule ^(.*)$ index.php [QSA,L]
  </IfModule>  
</VirtualHost>
```

Если имя конфигурации не определено, используется имя `production`. Для модульных тестов используется имя `test`.
Подробнее о тестах смотри ниже.


### База данных ###

Для соединения с БД вы должны задать пользователя, пароль и другие параметры в вашем файле конфигурации. 
Определение таблиц и минимумом данных найдете в `app/install/*.sql`.

Из консоли можно создать таблицы так:
```bash
$ php bin/console.php --env=test dbal:schema:update
Schema dropped
Schema created
```
В примере показана работа с окружением `test` — его параметры должны быть прописаны в 
`app/config/parameters/test.yml`.


### Тестирование ###

Я стараюсь покрыть тестами все классы фреймворка. Для некоторых тестов понадобится тестовая конфигурация!  
Скопируйте `app/config/parameters/example.yml.dist` в `test.yml`, отредактируйте по своему усмотрению.

Файл с описанием тестов находится в `app/phpunit.xml`. Если PHPUnit установлен, вы можете запустить все тесты так:
```bash
$ phpunit -c tests/
```

Запустить индивидуальный тест можно так:
```bash
$ phpunit \
  --bootstrap ./tests/bootstrap.php \
  --colors \
  ./tests/unit/R2/Application/ContainerTest.php
```
